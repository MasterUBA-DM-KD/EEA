---
title: "Trabajo Práctico 1: Regresión lineal"
subtitle: "Enfoque Estadístico del Aprendizaje"
author:
  - name: "Alejandro Uribe"
    url: https://github.com/jjallaire
    affiliation: RStudio
    affiliation_url: https://www.rstudio.com
date: "`r format(Sys.time(), '%d %B %Y')`"
lang: en
description: |
  Asignatura: Enfoque Estadístico del Aprendizaje
output:
  html_document:
    page-layout: full
    df_print: paged
    code-fold: show
    code-line-numbers: false
    code-tools: true
    code-overflow: scroll
    theme: cerulean
    number-sections: true
    highlight: pygments
    tidy: true
    toc: true
    toc_float:
      collapsed: true
      smooth_scroll: true
    toc-location: left
    css: doc.css
    grid:
      body-width: 2000px
      sidebar-width: 200px
      margin-width: 200px
website:
  sidebar:
      style: docked
      search: false
execute:
  echo: false
  warning: false
  freeze: auto
---

# Librerías

```{r, echo=TRUE, include=TRUE, results='hide', message=FALSE}
library(splitstackshape)
library(ggplot2)
library(magrittr)
library(moments)
library(dplyr)
library(patchwork)
library(car)
library(knitr)
library(mltools)
library(bookdown)
library(gplots)
library(tidyr)
library(GGally)
library(factoextra)
library(FactoMineR)
library(corrplot)
library(MASS)
library(reshape2)
library(reshape)
library(fastDummies)
library(e1071)
library(rsample)
library(tidyverse)
library(caret)

suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(GGally))
```

```{r set-options, echo=TRUE, cache=FALSE, include=FALSE, results='hide'}
options(width = 10000)
options(digits = 4)
options(nsmall = 0)
```

```{r setup, echo=TRUE, include=FALSE, results='hide'}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(warning = FALSE)
```

# Análisis exploratorios

## Análisis estructura y correlación

Leer el archivo "eph_train_2022.csv". ¿Qué puede mencionar sobre su estructura y variables?

```{r}
df_train <- read.csv("./datasets/eph_train_2022.csv", sep = ",", header = TRUE)
```

```{r}
head(df_train)
```

El dataset no cuenta con nulos en sus columnas.

```{r}
lapply(df_train, function(x) {
  length(which(is.na(x)))
})
```

Se procedió a separar el dataset en dos:

-   \`df_numericas\`: contiene features numéricas

-   \`df_categoricas\`: contiene features categóricas

```{r}
df_numericas <- Filter(is.numeric, df_train)
df_categoricas <- df_train[,!(names(df_train) %in% names(df_numericas))]
df_numericas <- df_numericas[, !(names(df_numericas) %in% c("trimestre", "ano4"))]

df_categoricas <- df_categoricas[, !(names(df_categoricas) %in% c("codusu", "fecha_nacimiento", "sexo"))]
```

```{r}
head(df_categoricas)
```

```{r}
data_long <- melt(df_train)
ggplot(
  data_long,
  aes(x = variable, y = value, fill = sexo)
) +
  geom_boxplot() +
  facet_wrap(~variable, scale = "free")
```

¿Cómo es la correlación entre las variables numéricas? Utilice y analice en detalle algún gráfico que sirva para sacar conclusiones sobre la asociación de variables realizando apertura por sexo.

```{r}
gpairs_lower <- function(g) {
  g$plots <- g$plots[-(1:g$nrow)]
  g$yAxisLabels <- g$yAxisLabels[-1]
  g$nrow <- g$nrow - 1

  g$plots <- g$plots[-(seq(g$ncol, length(g$plots), by = g$ncol))]
  g$xAxisLabels <- g$xAxisLabels[-g$ncol]
  g$ncol <- g$ncol - 1
  return(g)
}
```

```{r fig.align="center", echo = FALSE, fig.width = 14, fig.height=14}
g <- ggpairs(df_numericas,
  aes(color = df_train$sexo),
  columnLabels = gsub("_", " ", colnames(df_numericas), fixed = T),
  labeller = label_wrap_gen(10),
  lower = list(continuous = GGally::wrap("points", alpha = 0.5, size = 3)),
  diag = list(continuous = GGally::wrap("densityDiag", alpha = 0.5, size = 1)),
  upper = list(continuous = GGally::wrap("cor", alpha = 0.5, size = 5, color = "black")),
  legend = 1
) +
  theme_light() +
  labs(color = "Sexo") +
  theme(
    legend.position = "bottom",
    legend.text = element_text(size = 18),
    legend.title = element_text(size = 20),
    axis.text.y = element_text(size = 9),
    axis.text.x = element_text(size = 9, angle = 30),
    strip.text = element_text(size = 18, face = "bold")
  )

# gpairs_lower(g)
g
```

```{r fig.align="center", echo = FALSE, fig.width = 14, fig.height=14}
g <- ggpairs(df_categoricas,
  aes(color = df_train$sexo),
  columnLabels = gsub("_", " ", colnames(df_categoricas), fixed = TRUE),
  labeller = label_wrap_gen(10),
  lower = list(discrete = GGally::wrap("count", alpha = 0.5, size = 3)),
  diag = list(discrete = GGally::wrap("barDiag", alpha = 0.5, size = 1)),
  upper = list(discrete = GGally::wrap("count", alpha = 0.5, size=1)),
  legend = 1
) +
  theme_light() +
  labs(color = "Sexo") +
  theme(
    legend.position = "bottom",
    legend.text = element_text(size = 18),
    legend.title = element_text(size = 20),
    axis.text.y = element_text(size = 9),
    axis.text.x = element_text(size = 9, angle = 90,vjust=0.5, hjust=1),
    strip.text = element_text(size = 18, face = "bold")
  )

g
```

En particular, ¿Cómo es la correlación entre la variable a explicar (salario_horario) y el resto de las variables numéricas?

```{r}
m_cor <- cor(df_numericas)
corrplot(m_cor,
  method = "ellipse",
  type = "upper",
  diag = FALSE,
  tl.col = "black",
  cl.ratio = 0.3,
  tl.srt = 45,
  mar = c(0, 0, 1, 0),
  title = "Correlación Variables - Sleep Health and Lifestyle"
)
```

```{r include=FALSE, collapse=TRUE, echo=FALSE}
library(styler)
styler::style_file("TP1/eea2023_tp1_Uribe_Alejandro.Rmd")
```
